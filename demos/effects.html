<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>effects demo</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/demos.css">
    <link rel="stylesheet" href="jquery-ui/css/ui-darkness/jquery-ui-1.10.2.custom.css">
  </head>

  <body>

    <div class="container">

      <h1>Effects Demo</h1>

      <p><button id="play">Play / Pause</button></p>

      <p><button id="sample">Trigger Sample</button></p>

      <h3>Oscillator Hz:</h3>
      <div id="hz"></div>

      <h3>LFO Speed:</h3>
      <div id="speed"></div>

      <h3>LFO Amount:</h3>
      <div id="amount"></div>

      <h3>Reverb Size:</h3>
      <div id="reverbSize"></div>

      <h3>Reverb Dry:</h3>
      <div id="reverbDry"></div>

      <h3>Reverb Wet:</h3>
      <div id="reverbWet"></div>

      <h3>Delay Time:</h3>
      <div id="delayTime"></div>

      <h3>Delay Feedback:</h3>
      <div id="delayFeedback"></div>
    </div>

    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../js/audiolib.min.js"></script>
    <script src="jquery-ui/js/jquery-ui-1.10.2.custom.min.js"></script>
    <script src="samples/thatsright.js"></script>
    <script>

var playing = false,
  channelCount = 2,
  amount = 0.50,
  sampler,
  osc,
  device, 
  reverb,
  delay;

var audioCallback = function(buffer, channels){
  
    var length = buffer.length,
      index,
      sample,
      i;

    for (index = 0; index < length; index += channels) {

      sample = 0;

      sampler.generate();
      sample = sampler.getMix() * .6;

      if (playing) {

        if (lfo.frequency !== 0 && amount !== 0) {
          lfo.generate();
          osc.fm = lfo.getMix() * amount;
        }
        osc.generate();

        sample += osc.getMix() * .6;
      }

      delay.pushSample(sample);
      sample += delay.getMix() * .5;

      reverb.pushSample(sample, 0);
      reverb.pushSample(sample, 1);

      buffer[index] = reverb.getMix(0);
      buffer[index + 1] = reverb.getMix(1);
  }

};

var changeReverb = function(wet, dry, roomSize) {
  reverb = audioLib.Reverb(device.sampleRate, 2, wet, dry, roomSize, .1);
};

window.addEventListener('load', function(){

  device = audioLib.AudioDevice(audioCallback, channelCount);
  osc = audioLib.Oscillator(device.sampleRate, 400);

  sampler = audioLib.Sampler(device.sampleRate);
  var sample = atob(thatsright);
  sampler.loadWav(sample, true);

  lfo = audioLib.Oscillator(device.sampleRate, 1);
  lfo.waveShape = 'pulse';

  // sampleRate, channelCount, wet, dry, roomSize, damping, tuningOverride
  reverb = audioLib.Reverb(device.sampleRate, 2, 0.00, 1.00, 0.00, .1);

  delay = audioLib.Delay(device.sampleRate, 500, .5);

  $('#play').click(function(){
    playing = !playing;
  });

  $('#sample').click(function(){
    sampler.noteOn(440);
  });

  amount = 0.50;

  $('#speed').slider({
    min: 0,
    max: 50,
    value: lfo.frequency,
    step: 0.2,
    slide: function( event, ui ) {
      lfo.frequency = ui.value;
      if (lfo.frequency === 0) {
        osc.phase = 0;
        osc.fm = 0;
      }
    }
  });

  $('#amount').slider({
    min: 0,
    max: 1.00,
    value: amount,
    step: 0.01,
    slide: function( event, ui ) {
      amount = ui.value;
    }
  });

  $('#hz').slider({
    min: 60,
    max: 800,
    value: amount,
    step: 1,
    slide: function( event, ui ) {
      osc.frequency = ui.value;
    }
  });

  $('#reverbSize').slider({
    min: 0.00,
    max: 1.00,
    value: reverb.roomSize,
    step: 0.01,
    change: function( event, ui ) {
      changeReverb(reverb.wet, reverb.dry, ui.value);
    }
  });

  $('#reverbWet').slider({
    min: 0.00,
    max: 1.00,
    value: reverb.wet,
    step: 0.01,
    change: function( event, ui ) {
      changeReverb(ui.value, reverb.dry, reverb.wet);
    }
  });

  $('#reverbDry').slider({
    min: 0.00,
    max: 1.00,
    value: reverb.dry,
    step: 0.01,
    change: function( event, ui ) {
      changeReverb(reverb.wet, ui.value, reverb.wet);
    }
  });

  $('#delayTime').slider({
    min: 0.05,
    max: 1000,
    value: delay.time,
    step: 0.01,
    change: function( event, ui ) {
      delay.time = ui.value;
    }
  });

  $('#delayFeedback').slider({
    min: 0.00,
    max: 1.00,
    value: delay.feedback,
    step: 0.01,
    change: function( event, ui ) {
      delay.feedback = ui.value;
    }
  });

}, true);



    </script>
  </body>

</html>